"use strict";let t=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>t+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_"),"");var e;!function(e){const i={LOCAL:{USER_ID:"swa-userId"}},n="/api-ingest/v1/page/view";let r,o,a,s=!1,c=!1,l={inBrowser:!1,site:"",apiUrl:"",debug:!1};function u(t,e){navigator.sendBeacon(t,e)}e.analyticsPageInit=function(e){if(l={inBrowser:e.inBrowser,site:e.site,apiUrl:e.apiUrl,debug:!!e.debug},l.inBrowser){if(r)throw new Error("Analytics has already been initialized, `analyticsPageInit` must only be called once");r=t(),o=localStorage.getItem(i.LOCAL.USER_ID)||void 0,o||(o=t(),localStorage.setItem(i.LOCAL.USER_ID,o)),s||(l.debug&&console.log("pageTimeIncrementStarted"),s=!0,setInterval((()=>{"visible"===document.visibilityState&&(a&&a.time_on_page++,l.debug&&a&&console.log(a.page_url,a.time_on_page))}),1e3)),c||(c=!0,document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&l.debug&&console.log("VISIBLE",new Date),"hidden"===document.visibilityState&&(l.debug&&console.log("HIDDEN",new Date),a&&u(l.apiUrl+n,JSON.stringify(a)))})))}},e.analyticsPageChange=function(e){if(!l.inBrowser)return;if(!r||!o)throw new Error("Analytics have not been initialized");a&&(l.debug&&console.log("Sending previous analytic"),u(l.apiUrl+n,JSON.stringify(a)));const i=t(),s=(new Date).toISOString(),c=new URLSearchParams(window.location.search),g=Object.fromEntries(c.entries());a={site:l.site,user_id:o,session_id:r,page_id:i,page_url:e,page_opened_at:s,time_on_page:0,utm_source:g.utm_source,utm_medium:g.utm_medium,utm_campaign:g.utm_campaign,utm_term:g.utm_term,utm_content:g.utm_content,referrer:document.referrer};const d=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],m=[];for(let t of Object.keys(g))d.includes(t)||m.push(t+"="+g[t]);m.length>0&&(a.querystring=m.join(",")),l.debug&&console.log("Sending new analytic"),u(l.apiUrl+n,JSON.stringify(a))}}(e||(e={}));var i=Object.freeze({__proto__:null,get v1(){return e}});(()=>{const t=document.currentScript||document.querySelector("script[serverless-website-analytics]");if(!t)throw new Error("Could not find script tag with attribute 'serverless-website-analytics' on the script tag.");const n=t.getAttribute("site");if(!n)throw new Error("Could not find attribute 'site' on the script tag.");let r="";try{r=new URL(t.src).origin}catch(t){console.error("Could not parse URL from script tag",t)}let o=t.getAttribute("api-url");if(!r&&!o)throw new Error("Could not auto-detect script origin, specify the 'api-url' attribute on the script tag.");o||(o=r);const a=t.getAttribute("routing");if(a&&"path"!==a&&"hash"!==a)throw new Error("Attribute 'routing' must be either 'path' or 'hash'");function s(){return"path"===a?window.location.pathname:"hash"===a?window.location.hash?window.location.hash:"/":window.location.pathname+(window.location.hash?"#"+window.location.hash:"")}window.swa=i,e.analyticsPageInit({inBrowser:!0,site:n,apiUrl:o});let c=location.href;setInterval((function(){c!=location.href&&(c=location.href,e.analyticsPageChange(s()))}),500),e.analyticsPageChange(s())})();
//# sourceMappingURL=client-script.js.map
